\pgfdeclareverticalshading[lower.bg,upper.bg]{bmb@transition}{200cm}{%
  color(0pt)=(lower.bg); color(2pt)=(lower.bg); color(4pt)=(lower.bg)}

\setbeamersize{text margin left=2em,text margin right=2em} 

% =============== TABLE OF CONTENTS ===============
% table of contents (overview)
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}{\leavevmode\leftskip=3.2em\rlap{\hskip-2em\inserttocsectionnumber.\inserttocsubsectionnumber}\inserttocsubsection\par}


\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{blocks}[default]
\setbeamertemplate{enumerate items}[default]

\def\titleimagepath{}
\newcommand{\titleimage}[1]{\def\titleimagepath{#1}}

% =============== FRAME LAYOUT ===============
\setbeamertemplate{frametitle}{\vspace*{0.6em}\bfseries\insertframetitle \\
\usebeamerfont{framesubtitle}\insertframesubtitle
\par\vskip-6pt\hrulefill\vspace{-0.1em}
\logo { 
        \begin{tikzpicture}[overlay,remember picture]
        \node[left=0.2cm] at (current page.32){
            \includegraphics[height=1.5cm]{\titleimagepath}
        };
        \end{tikzpicture}
        }
        %-------------------------
        {\usebeamercolor[fg]{titlegraphic}\insertlogo\par}

}

% =============== FOOTER ===============
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[sep=0.2em,wd=\paperwidth,leftskip=0.5cm,rightskip=0.5cm]{footlinecolor}
    % \scriptsize{\insertshortinstitute}
    \hspace{1cm}
    % \scriptsize{\inserttitle}
    \hfill
    \scriptsize{\insertframenumber/\inserttotalframenumber}
  \end{beamercolorbox}%
}


% ================ TITLE PAGE ================

\setbeamertemplate{title page}{
    \vspace{8em}
    \begingroup
        \centering
        % ------------------------
        \begin{beamercolorbox}[sep=8pt,left]{title}
        \usebeamerfont{title}\inserttitle\par%
        \ifx\insertsubtitle\@empty%
        \else%
            \vskip0.25em%
            {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
        \fi%     
        \end{beamercolorbox}%
        \vskip0.5em\par
        % ------------------------
        \begin{beamercolorbox}[sep=8pt,left]{author}
        \usebeamerfont{author}\insertauthor
        \end{beamercolorbox}
        % \vskip-2em
        % ------------------------
        \vskip1em\par
        \begin{beamercolorbox}[sep=8pt,left]{institute}
        \usebeamerfont{institute}\insertinstitute
        \hspace*{0.5\linewidth}
        \usebeamerfont{date}\insertdate
        \end{beamercolorbox}
        % ------------------------
        
        % Logo on the title page
       \titlegraphic{
        \begin{tikzpicture}[overlay,remember picture]
        \node[anchor=north west, outer sep=10pt] at (current page.north west){
            \includegraphics[height=3cm]
            {\titleimagepath}
        };
        \end{tikzpicture}
        }
      
       {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
    \endgroup
    \vfill
}

% ================ AUTOMATIC TABLE OF CONTENTS ================

\AtBeginSection[]
{
    \begingroup
    \begin{frame}{Table of Contents}
    \framesubtitle{\textcolor{white}{BLANK}}
        \tableofcontents[currentsection]
    \end{frame}
    \endgroup
}


% ================ AUTOMATIC SUBTITLE ================
\makeatletter
    \pretocmd\beamer@checkframetitle{\framesubtitle{\@currentlabelname}}
\makeatother


% automate subtitle of each frame